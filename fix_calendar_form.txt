<form action="{{ route('checkout.show') }}" method="GET" class="space-y-6" 
    x-data="{
        unavailableDates: @json($unavailableDates),
        checkInPicker: null,
        checkOutPicker: null,
        initCalendars() {
            const self = this;
            
            this.checkInPicker = flatpickr(this.$refs.checkIn, {
                minDate: 'today',
                maxDate: new Date().fp_incr(180),
                dateFormat: 'Y-m-d',
                disable: this.unavailableDates,
                onChange: function(selectedDates) {
                    if (selectedDates.length > 0) {
                        const minCheckOut = new Date(selectedDates[0]);
                        minCheckOut.setDate(minCheckOut.getDate() + 1);
                        self.checkOutPicker.set('minDate', minCheckOut);
                    }
                },
                onDayCreate: function(dObj, dStr, fp, dayElem) {
                    const dateStr = dayElem.dateObj.toISOString().split('T')[0];
                    if (self.unavailableDates.includes(dateStr)) {
                        dayElem.className += ' flatpickr-disabled-custom';
                        const indicator = document.createElement('span');
                        indicator.className = 'blocked-indicator';
                        dayElem.appendChild(indicator);
                    }
                }
            });
            
            this.checkOutPicker = flatpickr(this.$refs.checkOut, {
                minDate: new Date().fp_incr(1),
                maxDate: new Date().fp_incr(180),
                dateFormat: 'Y-m-d',
                disable: this.unavailableDates,
                onDayCreate: function(dObj, dStr, fp, dayElem) {
                    const dateStr = dayElem.dateObj.toISOString().split('T')[0];
                    if (self.unavailableDates.includes(dateStr)) {
                        dayElem.className += ' flatpickr-disabled-custom';
                        const indicator = document.createElement('span');
                        indicator.className = 'blocked-indicator';
                        dayElem.appendChild(indicator);
                    }
                }
            });
        }
    }" 
    x-init="initCalendars()">
